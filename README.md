# teksystems-challenge
Technical challenge deliverables for TEKsystems

As for assumptions that were made when developing the policy, I figured the input given would be in the form of a CloudTrail event.  I also assumed the policy would not be specific to the single bucket (`the-bucket-we-want-to-protect`), so logic was added to also be able to function given an event for other S3 buckets as well.  The experience I have with OPA/Rego for AWS is through the CSPM tool Wiz where the inputs given were CloudTrail events.  I believe the only other policy language that would apply to AWS would be Cedar, but we're working with Rego.  I also assumed the role is specific to a single AWS account with the ID `123456789012`.  If this is not the case, that hard-coded ID in the RegEx in the policy can be replaced with `[0-9]{12}`.  

As far as edge cases, I tried to account for things I have seen in my experience, namely the same role name in different accounts (mismatched IDs in the ARN), similarly named rules that would match as substrings, and the role being used directly vs. being assumed with STS.  If given more detail about how we want to lock down access, further protections can be applied, such as restricting to a certain principal(s) using the role, granting access to bucket metadata actions against the bucket for other roles, things like that.

For monitoring and enforcement, this policy (if AWS supported it) would be enabled within the account the bucket is hosted in.  If the OPA policy can be directly attached to the bucket itself, the `bucketName` logic would not longer be needed.  Any results of `{allow: false]` should be flagged as an unauthorized entity attempted to access the bucket.  While this can be something like getting the bucket's location or listing the contents, these should still be investigated if the data in the bucket is sensitive.  The bucket should also be encrypted with a CMK whose policy is controlled/reviewed by a security team to further prevent unintended access.
